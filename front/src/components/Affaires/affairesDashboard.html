<div class="affairesDashboard" v-if="affaireLoaded">

    <!-- TITRE -->
    <md-toolbar>
        <div style="width: 96% " class="md-layout md-gutter md-alignment-center-space-between">
            <div class="md-layout-item">
                <h1>
                    Affaire {{ affaire.id }}
                    <span v-if="affaire.no_access != null">[{{ affaire.no_access }}]</span>
                    <span v-if="affaire.abandon === true"> - ABANDONNE</span>
                </h1>
            </div>

            <div class="md-layout-item" style="text-align: right;">
                <md-button class="md-primary md-raised" v-if="editAffaireAllowed" v-on:click="generateBordereauAffaire">Bordereau de l'affaire</md-button>
                <md-button class="md-primary md-raised" v-if="editAffaireAllowed && false" v-on:click="duplicateAffaire">Modification / Visa</md-button>
                
                <md-speed-dial style="align-items: flex-end;"
                    md-direction="bottom" class="md-fixed">
                    <md-button class="md-accent md-raised">
                        <md-icon>block</md-icon>
                    </md-button>

                    <md-speed-dial-content style="align-items: flex-end;">
                        <md-button class="md-accent" @click="callClotureAffaire" v-if="cloreAffaireEnabled" md-dense>Cloturer</md-button>
                        <md-button class="md-accent" @click="showConfirmAbandonAffaireDialog = true" v-if="abandonAffaireEnabled" md-dense>Abandonner</md-button>
                    </md-speed-dial-content>
                </md-speed-dial>
            </div>

        </div>
    </md-toolbar>

    <!-- INFORMATIONS GENERALES -->
    <div class="leftColumn">
        <InfosGenerales @modify-off="modifyOff" :affaire="affaire" :typesAffaires="typesAffaires" />
    </div>

    <!-- MAP -->
    <div class="rightColumn">
        <md-card class="mapHeight">
            <md-card-content>
                <!-- Afficher les oordonnées -->
                <div class="md-layout md-gutter">
                    <div class="md-layout-item md-size-30">
                        <md-field>
                            <label>Coordonnées</label>
                            <md-input v-model="[affaire.localisation_e | 0, affaire.localisation_n | 0].join(' / ')" readonly></md-input>
                        </md-field>
                    </div>
                    <div style="text-align: right;" class="md-layout-item" v-if="affaire.type_id===typesAffaires.mutation">
                        <md-button style="background-color: lightgray;" class="md-raised" @click="openSitnTheme('environnement')">Environnement</md-button>
                        <md-button style="background-color: lightgray;" class="md-raised" @click="openSitnTheme('amenagement_territoire')">Aménagement du territoire</md-button>
                    </div>
                    <div id="mapContainer">
                        <MapHandler ref="mapHandler" />
                    </div>
                </div>
            </md-card-content>
        </md-card>
    </div>

    <!-- PREAVIS -->
    <div class="affairesDashboard" v-if="affaire.type_id==typesAffaires.mutation">
        <preavis :affaire="affaire" />
    </div>

    <!-- NUMEROS -->
    <div class="affairesDashboard">
        <numerosAffaire :affaire="affaire" :typesAffaires="typesAffaires" ref="numeros" />
    </div>

    <!-- FACTURATION -->
    <div class="affairesDashboard">
        <Facturation ref="facturation" :typesAffaires="typesAffaires" :affaire="affaire" />
    </div>

    <!-- CONTROLE TECHNIQUE MUTATION -->
    <div class="affairesDashboard">
        <ControleMutation v-if="affaire.type_id===typesAffaires.mutation" />
    </div>

    <!-- CONTROLE TECHNIQUE PPE -->
    <div class="affairesDashboard">
        <ControlePPE v-if="affaire.type_id===typesAffaires.ppe" />
    </div>

    <!-- SUIVI DU MANDAT -->
    <div class="affairesDashboard" v-if="affaire.type_id===typesAffaires.mutation">
        <SuiviMandat />
    </div>

    <!-- DOCUMENTS -->
    <div class="affairesDashboard">
        <Documents v-if="false" />
    </div>

    <!-- REMARQUE -->
    <div class="affairesDashboard">
        <Remarques />
    </div>

    <!-- SUIVI D'AFFAIRE -->
    <div class="affairesDashboard">
        <suivi />
    </div>

    <!-- Duplication Affaire -->
    <!-- <div>
        <DuplicationAffaire ref="duplicationAffaireForm" :affaire="affaire"/>
    </div> -->

    <!-- Cloture Affaire -->
    <div>
        <ClotureAffaire ref="clotureAffaireForm" />
    </div>


    <!-- Dialog de confirmation de l'abandon d'une affaire -->
    <md-dialog-confirm
      :md-active.sync="showConfirmAbandonAffaireDialog"
      md-title="Abandon de l'affaire"
      md-content="<p>En abandonnant l'affaire, tous les numéros réservés seront abandonnés.</p> <p>Confirmer l'abandon de l'affaire?</p>"
      md-confirm-text="Confirmer"
      md-cancel-text="Annuler"
      @md-cancel="showConfirmAbandonAffaireDialog = false"
      @md-confirm="callAbandonAffaire" />

</div>
